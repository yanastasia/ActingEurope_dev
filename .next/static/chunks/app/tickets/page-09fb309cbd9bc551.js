(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[512],{2945:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),!function(e,t){for(var s in t)Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}(t,{default:function(){return d},getImageProps:function(){return l}});let a=s(4879),r=s(4535),i=s(2611),n=a._(s(149));function l(e){let{props:t}=(0,r.getImgProps)(e,{defaultLoader:n.default,imgConf:{deviceSizes:[640,750,828,1080,1200,1920,2048,3840],imageSizes:[16,32,48,64,96,128,256,384],path:"/_next/image",loader:"default",dangerouslyAllowSVG:!1,unoptimized:!0}});for(let[e,s]of Object.entries(t))void 0===s&&delete t[e];return{props:t}}let d=i.Image},3778:(e,t,s)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useMergedRef",{enumerable:!0,get:function(){return r}});let a=s(2149);function r(e,t){let s=(0,a.useRef)(null),r=(0,a.useRef)(null);return(0,a.useCallback)(a=>{if(null===a){let e=s.current;e&&(s.current=null,e());let t=r.current;t&&(r.current=null,t())}else e&&(s.current=i(e,a)),t&&(r.current=i(t,a))},[e,t])}function i(e,t){if("function"!=typeof e)return e.current=t,()=>{e.current=null};{let s=e(t);return"function"==typeof s?s:()=>e(null)}}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},4604:(e,t,s)=>{"use strict";s.d(t,{Xi:()=>c,av:()=>o,j7:()=>d,tU:()=>l});var a=s(8081),r=s(2149),i=s(2044),n=s(7687);let l=i.bL,d=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.B8,{ref:t,className:(0,n.cn)("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",s),...r})});d.displayName=i.B8.displayName;let c=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.l9,{ref:t,className:(0,n.cn)("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",s),...r})});c.displayName=i.l9.displayName;let o=r.forwardRef((e,t)=>{let{className:s,...r}=e;return(0,a.jsx)(i.UC,{ref:t,className:(0,n.cn)("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",s),...r})});o.displayName=i.UC.displayName},5186:(e,t,s)=>{"use strict";s.d(t,{default:()=>r.a});var a=s(2945),r=s.n(a)},7603:(e,t,s)=>{Promise.resolve().then(s.bind(s,8679))},8679:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>b});var a=s(8081),r=s(2149),i=s(5186),n=s(5516),l=s(5160),d=s(6810),c=s(900),o=s(588),m=s(4604),u=s(5844),x=s(452),f=s(8539),h=s(3688);function p(e){let{venueId:t,onSeatsSelected:s,isUserAdmin:i=!1}=e,{toast:n}=(0,u.dj)(),{t:d}=(0,x.o)(),[c,o]=(0,r.useState)([]),[p,v]=(0,r.useState)(null),[g,j]=(0,r.useState)(!0);(0,h.qc)(),(0,h.wR)(),(0,r.useEffect)(()=>{(async()=>{try{let e=await f.ds.getVenues(),s=e.find(e=>e.id===t.toString()||e.name===t);s?v(s):v(e[0]||null)}catch(e){console.error("Error loading venue:",e)}finally{j(!1)}})();let e=async e=>{let s=e.detail;v((await s.getVenues()).find(e=>e.id===t.toString()||e.name===t)||null)};return window.addEventListener("databaseUpdated",e),()=>{window.removeEventListener("databaseUpdated",e)}},[t]);let b=e=>{if(c.includes(e))o(c.filter(t=>t!==e));else{if(!i&&c.length>=5){n({title:d("maxSeatsReached"),description:d("maxSeatsReachedDesc"),variant:"destructive"});return}o([...c,e])}},N=(e,t)=>{if(!i)return;let[s,a]=e.split("-").map(Number);n({title:t?"Seat Released":"Seat Reserved",description:"Seat ".concat(e," has been ").concat(t?"made available":"reserved for sponsors")})},y=e=>(0,a.jsx)("div",{className:"space-y-2",children:e.map(e=>{if(0===e.seatCount)return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"mr-2 w-6 text-center font-medium",children:e.rowNumber}),(0,a.jsx)("div",{className:"flex flex-1 justify-center",children:(0,a.jsx)("div",{className:"text-sm text-muted-foreground italic",children:"No seats in this row"})})]},e.rowNumber);let t=Array.from({length:e.seatCount},(t,s)=>({rowNumber:e.rowNumber,seatNumber:s+1,isAvailable:Math.random()>.1}));return(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"mr-2 w-6 text-center font-medium",children:e.rowNumber}),(0,a.jsx)("div",{className:"flex flex-1 justify-center gap-1",children:t.map(e=>{let t="".concat(e.rowNumber,"-").concat(e.seatNumber),s=c.includes(t),r=!e.isAvailable;return(0,a.jsx)("button",{className:"h-7 w-7 rounded-t-md text-xs font-medium transition-colors ".concat(r?"cursor-not-allowed bg-gray-200 text-gray-400":s?"bg-primary-gold text-white":"bg-muted hover:bg-primary-gold/30"),onClick:e=>{i&&"contextmenu"===e.type?(e.preventDefault(),N(t,r)):r||b(t)},onContextMenu:e=>{i&&(e.preventDefault(),N(t,r))},disabled:r&&!i,"aria-label":"".concat(d("seat")," ").concat(t),children:e.seatNumber},t)})})]},e.rowNumber)})});if(g)return(0,a.jsx)("div",{className:"flex items-center justify-center p-8",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"h-8 w-8 animate-spin rounded-full border-4 border-primary-gold border-t-transparent mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-sm text-muted-foreground",children:"Loading seating chart..."})]})});if(!p)return(0,a.jsx)("div",{className:"text-center p-8",children:(0,a.jsx)("p",{className:"text-muted-foreground",children:"Venue not found"})});let w=[{id:"1",name:"Main Stage"===p.name?d("regularSeating"):d("mainSeating"),type:"regular",rows:p.rows}];return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"mb-2 text-lg font-semibold text-secondary-blue",children:d("selectYourSeats")}),(0,a.jsx)("div",{className:"mb-2 text-sm font-medium",children:p.name}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[d("selectedSeats"),": ",c.length>0?c.join(", "):d("none"),i&&(0,a.jsx)("span",{className:"ml-2 text-primary-gold",children:"(Admin: Unlimited seats)"})]})]}),(0,a.jsxs)("div",{className:"mx-auto max-w-4xl",children:[(0,a.jsx)("div",{className:"mb-8 rounded-md bg-primary-gold/20 p-2 text-center text-sm font-medium text-secondary-blue",children:d("stage")}),w.length>1?(0,a.jsxs)(m.tU,{defaultValue:w[0].id.toString(),children:[(0,a.jsx)(m.j7,{className:"grid w-full grid-cols-2 mb-6",children:w.map(e=>(0,a.jsx)(m.Xi,{value:e.id.toString(),children:e.name},e.id))}),w.map(e=>(0,a.jsxs)(m.av,{value:e.id.toString(),children:[(0,a.jsx)("div",{className:"mb-4 text-center",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-secondary-blue",children:e.name})}),y(e.rows)]},e.id))]}):(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"mb-4 text-center",children:(0,a.jsx)("h3",{className:"text-lg font-medium text-secondary-blue",children:w[0].name})}),y(w[0].rows)]}),(0,a.jsxs)("div",{className:"mb-6 flex justify-center gap-4 text-xs mt-6",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"mr-1 h-4 w-4 rounded-sm bg-muted"}),(0,a.jsx)("span",{children:d("available")})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"mr-1 h-4 w-4 rounded-sm bg-primary-gold"}),(0,a.jsx)("span",{children:d("selected")})]}),(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"mr-1 h-4 w-4 rounded-sm bg-gray-200"}),(0,a.jsx)("span",{children:d("unavailable")})]})]}),(0,a.jsx)("div",{className:"flex justify-center",children:(0,a.jsx)(l.$,{onClick:()=>{if(0===c.length){n({title:d("noSeatsSelected"),description:d("pleaseSelectSeats"),variant:"destructive"});return}s(c)},children:d("confirmSelection")})})]}),i&&(0,a.jsxs)("div",{className:"mt-4 rounded-md bg-muted p-3 text-sm",children:[(0,a.jsx)("p",{className:"font-medium text-secondary-blue",children:"Admin Instructions:"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Right-click on a seat to reserve it for sponsors (free of charge)."})]})]})}var v=s(3345);let g=(0,v.createServerReference)("40b033e3c3074280f6a4d1112f67981e3c3216570a",v.callServer,void 0,v.findSourceMapURL,"generateAndSendTicket");var j=s(2184);function b(){let{toast:e}=(0,u.dj)(),{t}=(0,x.o)(),[s,h]=(0,r.useState)(null),[v,b]=(0,r.useState)(1),[N,y]=(0,r.useState)({firstName:"",lastName:"",email:"",phone:""}),[w,k]=(0,r.useState)([]),[S,C]=(0,r.useState)(!1),[P,F]=(0,r.useState)([]),[E,R]=(0,r.useState)([]),[U,_]=(0,r.useState)(!1),[A,I]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=e=>{if(!e)return"Free";let t=Number.parseFloat(e.replace("€",""));return"".concat((1.96*t).toFixed(2)," лв.")},t=async t=>{let s=t.detail;F((await s.getEvents()).filter(e=>"performance"===e.type).map(t=>({id:t.id,title:t.title,company:t.company||"Acting Europe Festival",date:t.date,time:t.time,venue:t.venue,imageUrl:t.imageUrl||"/placeholder.svg?height=200&width=300",price:t.price?e(t.price):"Free",rawPrice:t.price}))),R(await s.getVenues())};return(async()=>{F((await f.ds.getEvents()).filter(e=>"performance"===e.type).map(t=>({id:t.id,title:t.title,company:t.company||"Acting Europe Festival",date:t.date,time:t.time,venue:t.venue,imageUrl:t.imageUrl||"/placeholder.svg?height=200&width=300",price:t.price?e(t.price):"Free",rawPrice:t.price}))),R(await f.ds.getVenues())})(),window.addEventListener("databaseUpdated",e=>{t(e)}),()=>{window.removeEventListener("databaseUpdated",e=>{t(e)})}},[]);let L=e=>{let{name:t,value:s}=e.target;y(e=>({...e,[t]:s}))},D=e=>{h(e),b(2)},M=async a=>{if(a.preventDefault(),_(!0),!N.firstName||!N.lastName||!N.email){e({title:t("missingInformation"),description:t("pleaseCompleteForm"),variant:"destructive"}),_(!1);return}try{let a=P.find(e=>e.id===s);if(!a)throw Error("Performance not found");let r={title:a.title,date:a.date,time:a.time,venue:a.venue,seats:w,customerName:"".concat(N.firstName," ").concat(N.lastName),email:N.email,phone:N.phone,price:a.rawPrice},i=await g(r);if(!i.success)throw Error(i.message||"Failed to generate ticket");I(i.bookingReference||"");let n={id:Date.now(),userId:1,eventId:a.id,performanceId:s,seats:w.map((e,t)=>({id:t+1,rowNumber:e.charCodeAt(0)-64,seatNumber:parseInt(e.substring(1)),isAvailable:!1})),customer:"".concat(N.firstName," ").concat(N.lastName),email:N.email,date:new Date().toISOString(),bookingReference:i.bookingReference||"",totalAmount:w.length*a.rawPrice,bookingStatus:"confirmed",event:{id:a.id,title:a.title,theatreId:0,venueId:0,eventType:"performance",eventDate:a.date,eventTime:a.time,description:"",price:a.rawPrice,theatre:{},venue:{}},bookingDate:new Date().toISOString()};f.ds.addBooking(n),b(4),C(!0),e({title:t("bookingConfirmed"),description:t("bookingConfirmedDesc")})}catch(t){console.error("Booking error:",t),e({title:"Booking Error",description:t instanceof Error?t.message:"Failed to complete booking",variant:"destructive"})}finally{_(!1)}},O=s?P.find(e=>e.id===s):null;return(0,a.jsxs)("div",{className:"container mx-auto px-4 py-12",children:[(0,a.jsx)("h1",{className:"mb-8 text-center text-4xl font-bold text-secondary-blue",children:t("bookTickets")}),(0,a.jsxs)(m.tU,{defaultValue:"performances",className:"mx-auto max-w-4xl",children:[(0,a.jsxs)(m.j7,{className:"grid w-full grid-cols-2",children:[(0,a.jsx)(m.Xi,{value:"performances",children:t("Performances")}),(0,a.jsx)(m.Xi,{value:"workshops",children:t("workshops")})]}),(0,a.jsx)(m.av,{value:"performances",children:(0,a.jsxs)("div",{className:"mb-8 rounded-lg bg-muted/30 p-4",children:[v>1&&O&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsxs)(l.$,{variant:"ghost",className:"mb-2",onClick:()=>b(Math.max(1,v-1)),children:["← ",t("back")]}),(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-lg border bg-card p-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsx)("div",{className:"relative h-16 w-16 overflow-hidden rounded",children:(0,a.jsx)(i.default,{src:O.imageUrl||"/placeholder.svg",alt:O.title,fill:!0,className:"object-cover"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-secondary-blue",children:O.title}),(0,a.jsxs)("p",{className:"text-sm text-muted-foreground",children:[O.date," • ",O.time," •"," ",O.venue]})]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"font-semibold text-secondary-blue",children:O.price}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:t("perTicket")})]})]})]}),1===v&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h2",{className:"mb-4 text-xl font-semibold text-secondary-blue",children:t("availablePerformances")}),P.length>0?(0,a.jsx)("div",{className:"space-y-4",children:P.map(e=>(0,a.jsx)(d.Zp,{className:"overflow-hidden",children:(0,a.jsx)(d.Wu,{className:"p-0",children:(0,a.jsxs)("div",{className:"flex flex-col md:flex-row",children:[(0,a.jsx)("div",{className:"relative h-48 md:h-auto md:w-1/3",children:(0,a.jsx)(i.default,{src:e.imageUrl||"/placeholder.svg",alt:e.title,fill:!0,className:"object-cover"})}),(0,a.jsxs)("div",{className:"flex flex-1 flex-col justify-between p-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"mb-1 text-lg font-semibold text-secondary-blue",children:e.title}),(0,a.jsx)("p",{className:"mb-2 text-sm text-muted-foreground",children:e.company}),(0,a.jsxs)("div",{className:"mb-4 space-y-1 text-sm",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n.A,{className:"h-4 w-4 text-primary-gold"}),(0,a.jsxs)("span",{children:[e.date," at ",e.time]})]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("venue"),":"]})," ",e.venue]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("price"),":"]})," ",e.price]})]})]}),(0,a.jsx)(l.$,{onClick:()=>D(e.id),children:t("bookTicket")})]})]})})},e.id))}):(0,a.jsxs)("div",{className:"rounded-lg border border-dashed p-8 text-center",children:[(0,a.jsx)("h3",{className:"mb-2 text-lg font-medium",children:t("noPerformancesYet")}),(0,a.jsx)("p",{className:"mb-4 text-muted-foreground",children:t("noPerformancesYetDesc")})]})]}),2===v&&O&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"mb-4 text-lg font-semibold text-secondary-blue",children:t("selectSeats")}),(0,a.jsx)(p,{venueId:O.venueId,onSeatsSelected:e=>{k(e),b(3)}})]}),3===v&&O&&(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"mb-4 text-lg font-semibold text-secondary-blue",children:t("yourDetails")}),(0,a.jsxs)("form",{onSubmit:M,className:"space-y-6",children:[(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4",children:[(0,a.jsx)("div",{className:"mb-2 font-medium",children:t("selectedSeats")}),(0,a.jsx)("div",{className:"flex flex-wrap gap-2",children:w.map(e=>(0,a.jsx)("div",{className:"rounded-md bg-primary-gold/20 px-2 py-1 text-sm font-medium text-secondary-blue",children:e},e))}),(0,a.jsxs)("div",{className:"mt-2 text-right text-sm",children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("total"),":"]})," ","".concat((Number.parseFloat(O.rawPrice.replace("€",""))*w.length*1.96).toFixed(2)," лв.")]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(o.Label,{htmlFor:"firstName",children:[t("firstName")," *"]}),(0,a.jsx)(c.p,{id:"firstName",name:"firstName",value:N.firstName,onChange:L,required:!0})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(o.Label,{htmlFor:"lastName",children:[t("lastName")," *"]}),(0,a.jsx)(c.p,{id:"lastName",name:"lastName",value:N.lastName,onChange:L,required:!0})]})]}),(0,a.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(o.Label,{htmlFor:"email",children:[t("email")," *"]}),(0,a.jsx)(c.p,{id:"email",name:"email",type:"email",value:N.email,onChange:L,required:!0}),(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Your tickets will be sent to this email address"})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsxs)(o.Label,{htmlFor:"phone",children:[t("phone")," (",t("optional"),")"]}),(0,a.jsx)(c.p,{id:"phone",name:"phone",type:"tel",value:N.phone,onChange:L})]})]}),(0,a.jsx)("div",{className:"flex justify-end",children:(0,a.jsx)(l.$,{type:"submit",disabled:U,children:U?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(j.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Processing..."]}):t("completeBooking")})})]})]}),4===v&&S&&O&&(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-6 text-center",children:[(0,a.jsx)("div",{className:"mx-auto mb-4 flex h-12 w-12 items-center justify-center rounded-full bg-green-100",children:(0,a.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,a.jsx)("h3",{className:"mb-2 text-xl font-semibold text-secondary-blue",children:t("bookingConfirmed")}),(0,a.jsx)("p",{className:"mb-4 text-muted-foreground",children:t("bookingConfirmationEmail")}),(0,a.jsxs)("div",{className:"mb-6 rounded-lg border bg-muted/30 p-4 text-left",children:[(0,a.jsx)("div",{className:"mb-2 font-medium",children:t("bookingDetails")}),(0,a.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("performance"),":"]})," ",O.title]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("date"),":"]})," ",O.date]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("time"),":"]})," ",O.time]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("venue"),":"]})," ",O.venue]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("seats"),":"]})," ",w.join(", ")]}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("span",{className:"font-medium",children:[t("total"),":"]})," ","".concat((Number.parseFloat(O.rawPrice.replace("€",""))*w.length*1.96).toFixed(2)," лв.")]}),A&&(0,a.jsxs)("div",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Booking Reference:"})," ",A]})]})]}),(0,a.jsxs)("div",{className:"flex justify-center gap-4",children:[(0,a.jsx)(l.$,{onClick:()=>{h(null),b(1),y({firstName:"",lastName:"",email:"",phone:""}),k([]),C(!1),I("")},children:t("bookAnotherTicket")}),(0,a.jsx)(l.$,{variant:"outline",children:t("downloadTicket")})]})]})]})}),(0,a.jsx)(m.av,{value:"workshops",children:(0,a.jsxs)("div",{className:"rounded-lg border p-6 text-center",children:[(0,a.jsx)("h3",{className:"mb-2 text-lg font-semibold text-secondary-blue",children:t("workshopsComingSoon")}),(0,a.jsx)("p",{className:"text-muted-foreground",children:t("workshopsComingSoonDesc")})]})})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[687,611,150,583,309,189,497,954,358],()=>t(7603)),_N_E=e.O()}]);